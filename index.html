<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>LOG 路 Mensajer铆a</title>
<link rel="manifest" href="manifest.json">
<style>
body{
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:#020617;
  color:#e5e7eb;
  margin:0;
  padding:20px;
}
h1{text-align:center;font-size:1.4rem;margin-bottom:4px;}
.firma{text-align:center;font-size:.75rem;opacity:.5;margin-bottom:20px;}
.card{
  background:#020617;
  border:1px solid #1e293b;
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
}
label{display:block;font-size:.85rem;margin-top:10px;opacity:.85;}
input{
  width:100%;padding:10px;border-radius:10px;
  border:1px solid #1e293b;margin-top:4px;
  background:#020617;color:#e5e7eb;outline:none;
}
button{
  width:100%;margin-top:14px;padding:12px;
  border-radius:12px;border:none;
  background:#2563eb;color:#fff;font-weight:600;cursor:pointer;
}
.envio{border-top:1px solid #1e293b;padding:12px 0;}
.estado{font-size:.8rem;opacity:.8;}
.acciones button{margin-top:6px;background:#334155;}
</style>
</head>
<body>

<h1>LOG 路 Mensajer铆a</h1>
<div class="firma">Artificial Intelligence 路 by Mario Andr茅s Narv谩ez Delgado</div>

<div class="card">
  <h3>Nuevo Env铆o</h3>
  <label>Cliente</label>
  <input id="cliente" />
  <label>Direcci贸n</label>
  <input id="direccion" />
  <label>Mensajero</label>
  <input id="mensajero" />
  <label>Costo ($)</label>
  <input id="costo" type="number" />
  <button onclick="guardarEnvio()">Guardar env铆o</button>
</div>

<div class="card">
  <h3>Env铆os</h3>
  <div id="lista"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
let envios = JSON.parse(localStorage.getItem('envios')) || [];
const clienteInput = document.getElementById('cliente');
const direccionInput = document.getElementById('direccion');
const mensajeroInput = document.getElementById('mensajero');
const costoInput = document.getElementById('costo');
const lista = document.getElementById('lista');

function guardarEnvio(){
  const cliente = clienteInput.value.trim();
  const direccion = direccionInput.value.trim();
  const mensajero = mensajeroInput.value.trim();
  const costo = costoInput.value.trim();
  if(!cliente||!direccion||!mensajero||!costo){alert('Completa todos los campos');return;}
  envios.push({cliente,direccion,mensajero,costo,estado:'Registrado',fecha:new Date().toLocaleString()});
  localStorage.setItem('envios',JSON.stringify(envios));
  clienteInput.value=direccionInput.value=mensajeroInput.value=costoInput.value='';
  render();
}
function cambiarEstado(i){
  const estados=['Registrado','En ruta','Entregado'];
  const actual=estados.indexOf(envios[i].estado);
  envios[i].estado=estados[actual+1]||estados[0];
  localStorage.setItem('envios',JSON.stringify(envios));
  render();
}
function generarPDF(i){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const e = envios[i];
  doc.setFontSize(16);
  doc.text('LOG 路 Mensajer铆a',20,20);
  doc.setFontSize(10);
  doc.text('Artificial Intelligence',20,26);
  doc.text('by Mario Andr茅s Narv谩ez Delgado',20,32);
  doc.setFontSize(12);
  doc.text(`Cliente: ${e.cliente}`,20,50);
  doc.text(`Direcci贸n: ${e.direccion}`,20,58);
  doc.text(`Mensajero: ${e.mensajero}`,20,66);
  doc.text(`Costo: $${e.costo}`,20,74);
  doc.text(`Estado: ${e.estado}`,20,82);
  doc.text(`Fecha: ${e.fecha}`,20,90);
  doc.rect(15,42,180,55);
  doc.save('comprobante_envio_LOG.pdf');
}
function render(){
  lista.innerHTML='';
  envios.forEach((e,i)=>{
    const div=document.createElement('div');
    div.className='envio';
    div.innerHTML=`<strong>${e.cliente}</strong><br>${e.direccion}<br> ${e.mensajero}<br> ${e.costo}<br><span class="estado">${e.estado} 路 ${e.fecha}</span><div class="acciones"><button onclick="cambiarEstado(${i})">Cambiar estado</button><button onclick="generarPDF(${i})">PDF</button></div>`;
    lista.appendChild(div);
  });
}
render();

if('serviceWorker'in navigator){
  window.addEventListener('load',()=>{
    navigator.serviceWorker.register('sw.js').then(()=>console.log('SW registrado'));
  });
}
</script>
</body>
</html>
